name       : graalvm
version    : 22.1.0
release    : 3
source     :
    - git|https://github.com/oracle/graal.git : vm-ce-22.1.0
    - git|https://github.com/graalvm/mx.git : 6.0.3
    - https://github.com/graalvm/labs-openjdk-17/releases/download/jvmci-22.1-b06/labsjdk-ce-17.0.3+7-jvmci-22.1-b06-linux-amd64.tar.gz : 19c514abae2f7a4dbe8095054fa48199d350601f439dad64dc2b5a9f3104934d
license    : GPL-2.0-or-later
component  : programming.tools
networking : yes
clang      : yes
summary    : High Performan—Åe. Cloud Native. Polyglot.
description: |
    GraalVM is an ecosystem for compiling and running applications written in most modern programming languages and offers the following benefits:
builddeps  :
    - glibc-devel
build      : |
    unset CFLAGS
    unset LDFLAGS

    # Setup the custom jdk required to build graal
    # we need a special version of java to build which includes some needed headers
    cp $sources/labsjdk-ce-17.0.3+7-jvmci-22.1-b06-linux-amd64.tar.gz $workdir
    tar xvf labsjdk-ce-17.0.3+7-jvmci-22.1-b06-linux-amd64.tar.gz
    export JAVA_HOME=$workdir/labsjdk-ce-17.0.3-jvmci-22.1-b06/

    # Setup MX build tool
    mkdir -p $workdir/mx-build-tool
    cp -r $sources/mx.git $workdir
    export PATH=$workdir/mx.git:$PATH

    # Finally Build Graal
    cd $workdir/vm
    mx --env ce build

    cd $workdir/substratevm
    mx graalvm-show
    mx build
    mx graalvm-home
install    : |
    install -dm00755 $installdir/usr/share/graalvm
    cp -r $workdir/sdk/latest_graalvm_home/* -t $installdir/usr/share/graalvm/

    # empty folder if it exists creates a devel eopkg package
    rm -Rf $installdir/usr/include/graalvm
    chown -R root:root $installdir/usr/share/graalvm/
